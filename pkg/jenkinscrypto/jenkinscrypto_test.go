package jenkinscrypto

import (
	"encoding/hex"
	"testing"
)

func TestDecrypt(t *testing.T) {
	masterkey := "7a9b94a4b09c1de0509aeeac9fdb262a4b2cd1dae6a107191546d3ffe576785049e749567045cf63a775dfcc22e0abdd78485cf5b724952b160177820c4d378bab5a78be17ed3541c3dafbaf7da87686bb6ca1de3d2797b04b4bc92137889e8c127f6fc7d7dfad64f3e1e396b36d6133dfd6d273bfc4228d09a34ebd23856930"
	hudsonutilsecret := "BDF28150520CC80FB4175D0236B4D12815757F9AAB3D03E58CC2952369A3420955CEBDF2CE7AF39AF2E728AB7C5AFA58454CF8B4A65F289F95AEE00670BB11EC7CA5AAC13F8C56A8F19DFE0A7D2C0DCA4DFFD36B8BB4116C2A5B1FEE4478C3C026D164D7840D9EC9FC2787BC84AD9071798DBB0E6AC6B9316B6A88EADBDAB275AAFC98E381BD55AB6328A1999440E7B55DC64BFB8A74BD11DFFE0F48614D8E28EC1438F4643FD7B72F56352A70B883F9A3387C66947F351AE9BA87E99E6D3F594F33DC436D7A24C56E7E07715B4EBD10A620DB28D2B074806F0D8580D1406B5D42BC6DC3853ED46EB21B75C274B72356F83A9F10661D88D0B0689F5FD3B9F7D1DE71234D9DBE65BD6080D93BEF052974"
	testvalue := "{AQAAABAAAAAQTLuWr9Hc+PO6JugpfBszCCCh7Orwzl/dLpyVP6cfcDg=}"
	expectedvalue := "admin"

	secret, _ := hex.DecodeString(hudsonutilsecret)
	k, _ := Decryptmasterkey(masterkey, secret)
	decrypted, _ := Decrypt(k, testvalue)

	if decrypted != expectedvalue {
		t.Errorf("Error decrypted v2, got: %v, want: %v", decrypted, expectedvalue)
	}
}
